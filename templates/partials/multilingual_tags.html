{%- if section.translations -%}
{%- set current_translations = section.translations -%}
{%- elif page.translations -%}
{%- set current_translations = page.translations -%}
{%- endif -%}

{%- if current_translations -%}

{#- Self-referencing hreflang for the current page -#}
<link rel="alternate" hreflang="{{ lang }}" href="{{ current_url | safe }}" />

{%- for translation in current_translations -%}
{%- set lcode = translation.lang | default(value = config.default_language) -%}

{#- Skip the current language â€” already covered by self-referencing tag above -#}
{%- if lcode == lang -%}
{%- continue -%}
{%- endif -%}

{#- Dynamically load the language strings for each language -#}
{%- set other_language_strings = load_data(path="i18n/" ~ lcode ~ ".toml", required=false) -%}
{%- if not other_language_strings -%}
{%- set other_language_strings = load_data(path="themes/tabi/i18n/" ~ lcode ~ ".toml", required=false) -%}
{%- endif -%}
<meta property="og:locale:alternate" content="{{ macros_translate::translate(key=" date_locale", default="en_GB" ,
    language_strings=other_language_strings) }}" />

{# Construct href for hreflang #}
{%- set href = translation.permalink -%}
{%- if lcode == config.default_language -%}
{%- set href = href | replace(from='/' ~ lang ~ '/', to = '/') -%}
{%- else -%}
{%- set href = href | replace(from='/' ~ lang ~ '/', to='/' ~ lcode ~ '/') -%}
{%- endif -%}
<link rel="alternate" hreflang="{{ lcode }}" href="{{ href | safe }}" />
{%- endfor -%}

{#- x-default hreflang pointing to the default language version -#}
{%- if lang == config.default_language -%}
<link rel="alternate" hreflang="x-default" href="{{ current_url | safe }}" />
{%- else -%}
{%- for translation in current_translations -%}
{%- if translation.lang == config.default_language -%}
{%- set default_href = translation.permalink | replace(from='/' ~ lang ~ '/', to = '/') -%}
<link rel="alternate" hreflang="x-default" href="{{ default_href | safe }}" />
{%- endif -%}
{%- endfor -%}
{%- endif -%}

{%- endif -%}